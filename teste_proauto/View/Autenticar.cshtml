@page
@model ProdutoCadastro.API.View.AutenticarModel
@{
    ViewData["Title"] = "Autenticação";
}

<h2>Autenticação</h2>

<form id="loginForm">
    <label for="cpf"> CPF:</label>
    <input type="text" id="cpf" name="cpf" required />

    <label for="placa"> Placa:</label>
    <input type="text" id="placa" name="placa" required />

    <button type="submit"> Entrar </button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src=”https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js”></script>
    <script src="~/js/sweetalert2.min.js"></script>

    <script>
        $(document).ready(function(){
            $("#loginForm").submit(function (event){
                event.preventDefault();

                var dados={
                    CPF: $("#cpf").val(),
                    Placa: $("#placa").val()
                };

                $.ajax({
                    url: "/autenticar",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringfy(dados),
                        success: function (resposta){
                            Swal.fire({
                            icon: "success",
                            title: "Autenticado!",
                            text: "Login realizado com sucesso."
                        });
                    },
                    error: function (xhr){
                        var mensagem = xhr.responseJSON?.message || "Erro ao autenticar.";
                        Swal.fire({
                            icon: "error",
                            title: "Falha na Autenticação",
                            text: mensagem
                        });
                    }
                });
            });
        }
    </script>
}
